<head>
  <link rel="stylesheet" href="/assets/styles/global.css">
</head>
<h1>ã‚ã„ã†ãˆãŠä½œæ–‡ ã‚²ãƒ¼ãƒ </h1>
<!-- ãŠé¡Œè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
<div id="topicDisplay"></div>

<!-- å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  -->
<form id="aiueoForm">
  <div id="inputFields"></div>
  <button type="button" onclick="submitForm()">é€ä¿¡</button>
</form>

<div class="security-icon">ğŸ”’</div>

<script>

  // ãƒ©ãƒ³ãƒ€ãƒ ã«ãŠé¡Œã‚’é¸ã¶
  const topic = "<%= word %>";
  const yomi = "<%= yomi %>";
  const baseUrl = "<%= baseURL %>";
  document.getElementById("topicDisplay").innerHTML = "<p>ãŠé¡Œ: " + topic + "</p>";

  // ãŠé¡Œã®å„æ–‡å­—ã«å¯¾å¿œã™ã‚‹å…¥åŠ›æ¬„ã‚’ä½œæˆã™ã‚‹
  const inputFieldsDiv = document.getElementById("inputFields");
  for (let i = 0; i < yomi.length; i++) {
    const char = yomi[i];

    // ãƒ©ãƒ™ãƒ«ä½œæˆ
    const label = document.createElement("label");
    label.textContent = char + "ï¼š";

    // å…¥åŠ›æ¬„ä½œæˆ
    const input = document.createElement("input");
    input.type = "text";
    input.id = "input" + i;
    input.name = "input" + i;

    // å…¥åŠ›æ¬„ã¨ãƒ©ãƒ™ãƒ«ã‚’ãƒ•ã‚©ãƒ¼ãƒ ã«è¿½åŠ 
    inputFieldsDiv.appendChild(label);
    inputFieldsDiv.appendChild(input);
    inputFieldsDiv.appendChild(document.createElement("br"));
  }

  // é€ä¿¡ãƒœã‚¿ãƒ³æŠ¼ä¸‹æ™‚ã®å‡¦ç†
  async function submitForm() {
    // å…¥åŠ›ã•ã‚ŒãŸå†…å®¹ã‚’é…åˆ—ã«æ ¼ç´
    const inputs = [];
    for (let i = 0; i < yomi.length; i++) {
      const inputVal = document.getElementById("input" + i).value;
      if (!inputVal || !inputVal.trim()) {
        alert("ã™ã¹ã¦ã®å…¥åŠ›ã‚’è¨˜å…¥ã—ã¦ãã ã•ã„");
        return; // å…¥åŠ›ãŒç©ºã¾ãŸã¯ç©ºç™½ã®å ´åˆã€å‡¦ç†ã‚’ä¸­æ–­ã™ã‚‹
      }

      // å„è¡ŒãŒæŒ‡å®šã•ã‚ŒãŸæ–‡å­—ã‹ã‚‰å§‹ã¾ã£ã¦ã„ã‚‹ã‹ã‚’ãƒã‚§ãƒƒã‚¯
      let prefix = yomi.charAt(i);
      const smallCaseToUpperCase = {
        'ã‚¡': 'ã‚¢',
        'ã‚£': 'ã‚¤',
        'ã‚¥': 'ã‚¦',
        'ã‚§': 'ã‚¨',
        'ã‚©': 'ã‚ª',
        'ãƒƒ': 'ãƒ„',
        'ãƒ£': 'ãƒ¤',
        'ãƒ¥': 'ãƒ¦',
        'ãƒ§': 'ãƒ¨'
      }
      if (smallCaseToUpperCase[prefix]) {
        prefix = smallCaseToUpperCase[prefix];
      }
      console.log(prefix);
      const response = await fetch(`${baseUrl}/api/v1/starts-with`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ text: inputVal, prefix })
      });
      const result = await response.json();
      console.log(result);

      if (!result) {
        alert(`å…¥åŠ›ãŒã€Œ${prefix}ã€ã‹ã‚‰å§‹ã¾ã£ã¦ã„ã¾ã›ã‚“: ${inputVal}`);
        return; // å…¥åŠ›ãŒæŒ‡å®šã•ã‚ŒãŸæ–‡å­—ã‹ã‚‰å§‹ã¾ã£ã¦ã„ãªã„å ´åˆã€å‡¦ç†ã‚’ä¸­æ–­ã™ã‚‹
      }

      inputs.push(inputVal);
    }

    // ä¿å­˜ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã¾ã¨ã‚ã‚‹
    const formData = {
      topic: topic,
      topicYomi: yomi,
      inputs: inputs
    };

    // localStorageã«JSONæ–‡å­—åˆ—ã¨ã—ã¦ä¿å­˜
    localStorage.setItem("aiueoData", JSON.stringify(formData));

    // çµæœãƒšãƒ¼ã‚¸ã«é·ç§»
    window.location.href = `/aiueo-sakubun/result`;
  }
</script>

<%- contentFor("css") %>
  <link rel="stylesheet" href="/styles/input.css">
